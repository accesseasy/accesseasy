<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Host Dashboard — accesseasy</title>
  <style>
    :root{--bg:#0b0f14;--card:#121826;--accent:#f7931a;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937}
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu}
    body{background:var(--bg);color:var(--text);min-height:100vh;padding:3rem}
    .container{max-width:980px;margin:0 auto}
    h1{font-size:1.6rem;margin-bottom:0.5rem}
    p.lead{color:var(--muted);margin-bottom:1.5rem}
    .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1rem}
    .card{background:var(--card);border:1px solid var(--border);padding:1rem;border-radius:10px;position:relative}
    label{display:block;font-size:0.9rem;margin-bottom:0.35rem;color:var(--muted)}
    input[type="text"], select, textarea{width:100%;padding:0.5rem;border-radius:6px;border:1px solid #26303a;background:#0f1418;color:var(--text)}
    .ticket-options{display:flex;flex-wrap:wrap;gap:0.5rem}
    .ticket-options label{background:#0f1418;padding:0.45rem 0.65rem;border-radius:6px;border:1px solid #26303a;cursor:pointer;user-select:none}
    .ticket-options input{display:none}
    .ticket-options input:checked+span{background:var(--accent);color:#000;padding:0.45rem 0.65rem;border-radius:6px}
    .asset-buttons{display:flex;gap:0.5rem;flex-wrap:wrap;z-index:3;position:relative}
    .asset-buttons button{background:#0f1418;color:var(--text);border:1px solid #26303a;padding:0.5rem 0.75rem;border-radius:6px;cursor:pointer}
    .asset-buttons button.active{background:var(--accent);color:#000}
    .fees-box{background:#0e1620;border:1px solid #26303a;padding:0.8rem;border-radius:8px;margin-top:12px}
    .fees-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .token-row{display:flex;justify-content:space-between;padding:6px 0}
    .token-name{color:var(--muted)}
    .token-value{color:var(--text);font-weight:700}
    .small{font-size:0.85rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <h1>Host Dashboard</h1>
    <p class="lead">Create and configure your event. All fields are displayed in English.</p>

    <form id="event-form">
      <div class="dashboard-grid">

        <section class="card">
          <h2>Number of Tickets</h2>
          <div class="ticket-options" role="radiogroup" aria-label="Ticket quantities">
            <label><input type="radio" name="tickets" value="100"><span>100 Tickets</span></label>
            <label><input type="radio" name="tickets" value="250"><span>250 Tickets</span></label>
            <label><input type="radio" name="tickets" value="500"><span>500 Tickets</span></label>
            <label><input type="radio" name="tickets" value="1000"><span>1000 Tickets</span></label>
            <label><input type="radio" name="tickets" value="2500"><span>2500 Tickets</span></label>
            <label><input type="radio" name="tickets" value="10000"><span>10000 Tickets</span></label>
          </div>
        </section>

        <section class="card">
          <h2>Price & Fees</h2>

          <label>Payment Asset</label>
          <div class="asset-buttons" role="group" aria-label="Payment assets">
            <button type="button" data-asset="USDC">USDC</button>
            <button type="button" data-asset="EURC">EURC</button>
            <button type="button" data-asset="NWO">NWO</button>
            <button type="button" data-asset="DESPERADO">DESPERADO</button>
          </div>

          <label style="margin-top:0.75rem">Network</label>
          <select id="network"><option value="devnet" selected>Devnet (test)</option><option value="mainnet">Mainnet</option></select>

          <div class="fees-box" aria-live="polite">
            <div class="small" style="font-weight:700;margin-bottom:6px">Fees (selected ticket quantity)</div>
            <div class="fees-row"><div>Platform Fee</div><div id="platform-fee">—</div></div>
            <div class="fees-row"><div>Total Fee</div><div id="total-fee">—</div></div>
            <div class="fees-row"><div id="asset-amt-label">Amount in selected asset</div><div id="asset-amt">t.b.a</div></div>

            <div style="margin-top:8px">
              <div class="token-row"><div class="token-name">SOL price (USD)</div><div class="token-value" id="sol-usd">—</div></div>
              <div class="token-row"><div class="token-name">EURC (contract)</div><div class="token-value" id="euro-contract">HzwqbKZw8HxMN6bF2yFZNrht3c2iXXzpKcFu7uBEDKtr</div></div>
              <div class="small">If EURC selected, "Amount in selected asset" shows live EURC amount for the total platform fee.</div>
            </div>

            <div style="margin-top:10px">
              <button type="button" id="connect-wallet">Connect Wallet</button>
              <button type="button" id="pay-fees" disabled>Pay Fees</button>
              <div id="wallet-status" class="small">Not connected</div>
            </div>

            <div id="tx-status" class="small" style="margin-top:8px"></div>
          </div>
        </section>

      </div>

      <div style="margin-top:1rem">
        <button type="submit">Save Event</button>
        <button type="button" id="reset">Reset</button>
      </div>
    </form>
  </div>

  <script src="https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.js"></script>
  <script>
    (function(){
      const FEE_TABLE = { "100":0.3,"250":0.55,"500":1.0,"1000":1.8,"2500":3.0,"10000":9.0 };
      const COINGECKO_CONTRACT_API = 'https://api.coingecko.com/api/v3/coins/solana/contract/';
      const EURC_CONTRACT = 'HzwqbKZw8HxMN6bF2yFZNrht3c2iXXzpKcFu7uBEDKtr';
      const receiverAddress = 'UkG6htp8SmC4ukEVGXFbhngiKo86cquYupKha36FfFE';

      const ticketRadios = Array.from(document.querySelectorAll('input[name="tickets"]'));
      const platformFeeEl = document.getElementById('platform-fee');
      const totalFeeEl = document.getElementById('total-fee');
      const assetAmtLabel = document.getElementById('asset-amt-label');
      const assetAmtEl = document.getElementById('asset-amt');
      const solUsdEl = document.getElementById('sol-usd');

      let selectedTicket = null;
      let totalSOL = 0;
      let selectedAsset = null;

      function fmtSOL(s){ return s.toFixed(6) + ' SOL'; }
      function safeFmt(n){ if(n==null || !isFinite(n)) return 't.b.a'; return Number(n.toFixed(6)).toString(); }

      // update fee display when ticket selection changes
      function updateFees(){
        const sel = ticketRadios.find(r=>r.checked);
        if(!sel){ platformFeeEl.textContent='—'; totalFeeEl.textContent='—'; assetAmtEl.textContent='t.b.a'; selectedTicket=null; totalSOL=0; return; }
        selectedTicket = sel.value;
        totalSOL = FEE_TABLE[selectedTicket];
        platformFeeEl.textContent = fmtSOL(totalSOL);
        totalFeeEl.textContent = fmtSOL(totalSOL);
        updateAssetAmount(); // recalc with current asset
      }

      ticketRadios.forEach(r=>r.addEventListener('change', updateFees));

      // asset button selection (event delegation)
      document.querySelector('.asset-buttons').addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-asset]');
        if(!btn) return;
        document.querySelectorAll('.asset-buttons button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        selectedAsset = btn.getAttribute('data-asset');
        updateAssetAmount();
      });

      async function fetchSolUsd(){
        try{
          const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
          const j = await res.json();
          return j?.solana?.usd ?? null;
        }catch(e){ return null; }
      }

      async function fetchTokenUsdByContract(contract){
        try{
          const res = await fetch(COINGECKO_CONTRACT_API + encodeURIComponent(contract));
          if(!res.ok) return null;
          const j = await res.json();
          return j?.market_data?.current_price?.usd ?? null;
        }catch(e){ return null; }
      }

      // main: update displayed asset amount for selected asset
      async function updateAssetAmount(){
        assetAmtEl.textContent = 't.b.a';
        if(!selectedAsset || !selectedTicket || !totalSOL) return;

        // always show SOL USD if possible
        const solUsd = await fetchSolUsd();
        if(solUsd) solUsdEl.textContent = '$' + Number(solUsd).toFixed(2);
        else solUsdEl.textContent = 'N/A';

        if(selectedAsset === 'EURC'){
          // use CoinGecko contract endpoint for EURC
          assetAmtLabel.textContent = 'Amount in EURC';
          const tokenUsd = await fetchTokenUsdByContract(EURC_CONTRACT);
          if(!tokenUsd || !solUsd){
            assetAmtEl.textContent = 't.b.a';
            return;
          }
          // amount_in_EURC = totalSOL * SOL_USD / token_USD
          const amount = (totalSOL * solUsd) / tokenUsd;
          assetAmtEl.textContent = safeFmt(amount);
          return;
        }

        if(selectedAsset === 'USDC'){
          // if you want same behavior for USDC, you can add its contract and compute similarly
          assetAmtLabel.textContent = 'Amount in USDC';
          // not implemented here? (existing code can be extended)
          assetAmtEl.textContent = 't.b.a';
          return;
        }

        // other tokens: show t.b.a
        assetAmtLabel.textContent = 'Amount in selected asset';
        assetAmtEl.textContent = 't.b.a';
      }

      // initialize
      ticketRadios.forEach(r => { if(r.checked) updateFees(); });
      // ensure SOL price shown on load
      fetchSolUsd().then(s=>{ if(s) solUsdEl.textContent = '$' + Number(s).toFixed(2); });

      // reset behavior
      document.getElementById('reset').addEventListener('click', ()=>{
        document.getElementById('event-form').reset();
        selectedAsset = null;
        document.querySelectorAll('.asset-buttons button').forEach(b=>b.classList.remove('active'));
        platformFeeEl.textContent='—';
        totalFeeEl.textContent='—';
        assetAmtEl.textContent='t.b.a';
        solUsdEl.textContent='—';
        selectedTicket = null;
        totalSOL = 0;
      });

    })();
  </script>
</body>
</html>
